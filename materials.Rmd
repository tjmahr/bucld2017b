---
title: "Get raw data from the database"
author: "Tristan Mahr"
date: "`r Sys.Date()`"
output: github_document
---

```{r setup, include = FALSE, message = FALSE, warning = FALSE, results = 'hide'}
library("knitr")
opts_chunk$set(
  warning = FALSE,
  collapse = TRUE, 
  comment = "#>", 
  message = FALSE,
  fig.width = 8,
  # fig.height = 6,
  fig.asp = 0.618,
  dpi = 300,
  out.width = "80%")

wd <- rprojroot::find_rstudio_root_file()
opts_knit$set(root.dir = wd)
```











## Problem statement

ME would like to look at the data for the RWL task for participants in the
Dialect Switch study. I will 

* summarize child-level measurements for the participants in these studies
* wrangle and reduce the eyetracking data 
* plot the main effect of dialect on familiar word recognition









```{r}
df_rwl_looks <- df_rwl_looks %>% 
  anti_join(df_participants_to_drop) %>% 
  anti_join(df_trials_to_drop) %>% 


```


## Summarize child-level information

Now that we know which blocks to include, we can get the vocabulary scores for
the children who contributed those blocks.

```{r}
df_evt <- tbl(l2t_main, "EVT") %>% 
  select(Study, ResearchID, EVT_Age:EVT_Standard) %>% 
  collect()

df_ppvt <- tbl(l2t_main, "PPVT") %>% 
  select(Study, ResearchID, PPVT_Age:PPVT_Standard) %>% 
  collect()

df_child_vars <- df_child_info %>% 
  select(Study, ResearchID, ChildStudyID, Female:Gender) %>% 
  distinct() %>% 
  left_join(df_evt) %>% 
  left_join(df_ppvt)
```






## Plot looks to each competitor type.

```{r aoi-plots}
df_looks_to_aois <- df_looks %>% 
  select(Study, ResearchID, `Child hears`:`Maternal edu.`, `Exp. vocab.`,
         Time, starts_with("Prop_")) %>% 
  tidyr::gather(AOI, Proportion, starts_with("Prop_")) %>% 
  mutate(AOI = AOI %>% 
           stringr::str_replace("Prop_", "") %>% 
           stringr::str_replace("Foil", "")) 

df_looks_to_aois$AOI <- factor(
  df_looks_to_aois$AOI, 
  levels = c("Target", "Phonological", "Semantic", "Unrelated"))

df_looks_to_aois$Image <- factor(
  df_looks_to_aois$AOI, 
  labels = c("Target word", "Phonological foil", "Semantic foil", "Unrelated word"),
  levels = c("Target", "Phonological", "Semantic", "Unrelated"))


ggplot(df_looks_to_aois) + 
  aes(x = Time, y = Proportion, color = Image) + 
  geom_hline(yintercept = .25, size = 1.25, color = "#cccccc") + 
  stat_summary() + 
  theme_ipsum_rc(axis_title_size = 11) + 
  theme(legend.position = "bottom", legend.text = element_text(size = 10)) + 
  labs(x = plot_text$x_time, 
       y = plot_text$y_image) + 
  xlim(0, 2000)

ggplot(df_looks_to_aois) + 
  aes(x = Time, y = Proportion, color = Image) + 
  geom_hline(yintercept = .25, size = 1.25, color = "#cccccc") + 
  stat_summary() + 
  facet_wrap("`Child hears`", labeller = label_both) + 
  theme_ipsum_rc(axis_title_size = 11) + 
  theme(legend.position = "bottom", legend.text = element_text(size = 10)) + 
  labs(x = plot_text$x_time, 
       y = plot_text$y_image) + 
  xlim(0, 2000)
```

By AOI

```{r by-aoi}
ggplot(df_looks_to_aois %>% filter(Image == "Phonological foil")) + 
  aes(x = Time, y = Proportion, color = `Child hears`) + 
  geom_hline(yintercept = .25, size = 1.25, color = "#cccccc") + 
  stat_summary() + 
  facet_wrap("Image") + 
  theme_ipsum_rc(axis_title_size = 11) + 
  theme(legend.position = "bottom", legend.text = element_text(size = 10)) + 
  labs(x = plot_text$x_time, 
       y = plot_text$y_image) + 
  xlim(0, 2000)

# Use %+% to replace the data-set used in a plot
last_plot() %+% 
  filter(df_looks_to_aois, Image == "Semantic foil")

last_plot() %+% 
  filter(df_looks_to_aois, Image == "Unrelated word")

last_plot() %+% 
  filter(df_looks_to_aois, Image == "Target word")
```

AOI by maternal edu

```{r aoi-by-medu}
ggplot(df_looks_to_aois %>% 
         filter(Image == "Phonological foil", !is.na(`Maternal edu.`))) + 
  aes(x = Time, y = Proportion, color = `Maternal edu.`) + 
  geom_hline(yintercept = .25, size = 1.25, color = "#cccccc") + 
  stat_summary() + 
  facet_wrap("Image") + 
  theme_ipsum_rc(axis_title_size = 11) + 
  viridis::scale_color_viridis(discrete = TRUE, option = "inferno", end = .9) +
  theme(legend.position = "bottom", legend.text = element_text(size = 10)) + 
  labs(x = plot_text$x_time, 
       y = plot_text$y_image) + 
  xlim(0, 2000)

last_plot() %+% 
  filter(df_looks_to_aois, 
         Image == "Semantic foil", !is.na(`Maternal edu.`))

last_plot() %+% 
  filter(df_looks_to_aois, 
         Image == "Unrelated word", !is.na(`Maternal edu.`))

last_plot() %+% 
  filter(df_looks_to_aois, 
         Image == "Target word", !is.na(`Maternal edu.`))


ggplot(df_looks_to_aois %>% filter(!is.na(`Maternal edu.`))) + 
  aes(x = Time, y = Proportion, color = `Maternal edu.`) + 
  geom_hline(yintercept = .25, size = 1.25, color = "#cccccc") + 
  stat_summary(fun.y = "mean", geom = "line", size = 1.5) + 
  viridis::scale_color_viridis(discrete = TRUE, option = "inferno", end = .9) +
  facet_wrap("Image") + 
  theme_ipsum_rc(axis_title_size = 11) + 
  theme(legend.position = "bottom", legend.text = element_text(size = 10)) + 
  labs(x = plot_text$x_time, 
       y = plot_text$y_image) + 
  xlim(0, 2000)


ggplot(df_looks_to_aois) + 
  aes(x = Time, y = Proportion, color = `Native dialect`) + 
  geom_hline(yintercept = .25, size = 1.25, color = "#cccccc") + 
  stat_summary(fun.y = "mean", geom = "line", size = 1.5) + 
  viridis::scale_color_viridis(discrete = TRUE, option = "viridis", end = .9) +
  facet_wrap("Image") + 
  theme_ipsum_rc(axis_title_size = 11) + 
  theme(legend.position = "bottom", legend.text = element_text(size = 10)) + 
  labs(x = plot_text$x_time, 
       y = plot_text$y_image) + 
  xlim(0, 2000)

ggplot(df_looks_to_aois) + 
  aes(x = Time, y = Proportion, color = `Child hears`) + 
  geom_hline(yintercept = .25, size = 1.25, color = "#cccccc") + 
  stat_summary() + 
  facet_wrap("AOI", labeller = label_both) + 
  theme_ipsum_rc(axis_title_size = 11) + 
  theme(legend.position = "bottom", legend.text = element_text(size = 10)) + 
  labs(x = plot_text$x_time, 
       y = plot_text$y_target) + 
  xlim(0, 2000)


```

By vocabulary.

```{r by-vocabulary}
ggplot(df_looks_to_aois %>% 
         filter(Image == "Phonological foil", !is.na(`Exp. vocab.`))) + 
  aes(x = Time, y = Proportion, color = `Exp. vocab.`) + 
  geom_hline(yintercept = .25, size = 1.25, color = "#cccccc") + 
  stat_summary() + 
  facet_wrap("Image") + 
  theme_ipsum_rc(axis_title_size = 11) + 
  viridis::scale_color_viridis(discrete = TRUE, option = "plasma", end = .9) +
  theme(legend.position = "bottom", legend.text = element_text(size = 10)) + 
  labs(x = plot_text$x_time, 
       y = plot_text$y_image) + 
  xlim(0, 2000)

last_plot() %+% 
  filter(df_looks_to_aois, 
         Image == "Semantic foil", !is.na(`Exp. vocab.`))

last_plot() %+% 
  filter(df_looks_to_aois, 
         Image == "Unrelated word", !is.na(`Exp. vocab.`))

last_plot() %+% 
  filter(df_looks_to_aois, 
         Image == "Target word", !is.na(`Exp. vocab.`)) 
```
